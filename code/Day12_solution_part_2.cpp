#include <array>
#include <exception>
#include <fstream>
#include <functional>
#include <iostream>
#include <iterator>
#include <limits>
#include <list>
#include <map>
#include <memory>
#include <numeric>
#include <sstream>
#include <string>
#include <string_view>
#include <unordered_set>
#include <vector>

namespace{

constexpr std::string_view Input =

false ?

"???.### 1,1,3\n"
".??..??...?##. 1,1,3\n"
"?#?#?#?#?#?#?#? 1,3,1,6\n"
"????.#...#... 4,1,1\n"
"????.######..#####. 1,6,5\n"
"?###???????? 3,2,1\n"

:

"??#??#????## 2,7\n"
"..?##????????.?#?.? 10,2\n"
"#??.???..? 1,1,1\n"
"#??.#??.??#?#????#?# 2,1,6,3\n"
"?.#??.????..?.??? 1,2\n"
"#???##?.???#? 2,3,5\n"
"?##??#????.??. 2,3,2\n"
"??.#??#?????##? 2,1,3,4\n"
"?#????#?#.. 2,1,3\n"
"?#???#???##?#??? 2,11\n"
"#?##??.#??#?? 6,2,1\n"
"#.?#????#?#.?? 1,2,5,2\n"
"????#?#?#???? 1,6,1,1\n"
".?????.??? 2,1\n"
"????????.?#.??? 5,1,1,1\n"
"????..???????.??? 1,1\n"
"?#???#??#??.????.# 11,1,1,1\n"
"???.#?.???#? 2,2,2\n"
"???.???.????##? 1,5\n"
"??#?#???.#??????#??? 1,5,3,3\n"
"???.???.????. 1,2,1,1\n"
"????#?...????. 4,1\n"
"?.????#??#? 1,7\n"
".?#?.?.##?.?????? 1,3,2,2\n"
"????.?????##?.# 3,8,1\n"
"????#..????? 1,1,3\n"
".?#???.#????. 1,2,1,2\n"
"????.??###.#??.??? 1,1,4,3,1\n"
"?????????? 1,1,1\n"
"?#.??#...???? 2,1,1\n"
"?#????#?????? 7,3\n"
"?????.#####??? 1,6\n"
"?..?##.#?????? 1,2,4\n"
"#??#?#???????????#? 1,4,1,4,1,1\n"
"??#??###.???#??. 3,3,3\n"
"??????.?#??.?? 3,2\n"
"?#???#??#??..?# 6,1,2\n"
"#.??.??##?????#?? 1,1,10\n"
".?#???#?.? 2,4\n"
"???..????## 2,1,2\n"
"??????????????? 1,3,1\n"
"??##???????### 1,6,4\n"
"?#??????.??? 2,1\n"
"??#??????#???? 5,2,2\n"
"?#.??#???#?? 2,2,1,1\n"
"??#?????#???????. 2,1,1,4\n"
"?#?##??#?.. 4,3\n"
"##?????#??.??? 9,1,1\n"
"??.?...????#???#? 2,9\n"
"?????????.? 3,1\n"
".???.??#?.????? 2,4,1\n"
"#?##.?#?#????? 4,1,6\n"
"????#??#?#??? 1,8\n"
".??.?.###?????? 1,7\n"
"??##????#. 4,1,2\n"
"???#?.???. 2,1\n"
".?##?##?#?.?#????# 7,3,3\n"
"#????..####??.#? 2,1,4,1,1\n"
"#..#?#?????#??? 1,9\n"
"#.??????.?#??#..???# 1,6,1,1,1,1\n"
"???????##?#???#.??? 1,1,5,2,2\n"
"?#????.???#? 5,3\n"
"#.?#?##??????#?#?? 1,14\n"
".????..?.#???#. 1,1,1,2,1\n"
"?#????#???.#????? 8,1,2\n"
"????#?.??#??????. 1,3,7\n"
"??.??.?.???? 1,1,1,1\n"
"??#????..??? 2,1,1,2\n"
"?.??#??#??#?.?.???# 10,2\n"
".?#.??#??.? 1,5\n"
"?.##????????##?? 4,1,3\n"
".?.??##?#??? 1,6\n"
"?????#.??? 1,1,1\n"
".#?#???#???? 4,3,1\n"
"????#??.??????? 1,3,1,1,1\n"
"???#?.??#?##?# 3,7\n"
"?#?#?#???????? 8,1\n"
"??.?#????? 1,2\n"
"?#???#????.??????? 1,1,3,1,1,1\n"
"##???.???.? 3,3\n"
"####???????.???? 4,3,1\n"
"??#?##??????? 6,3\n"
"?..??????? 3,2\n"
".?#??###????#? 8,3\n"
"##?###????? 8,1\n"
"?.?#?????###??.??#?? 10,1\n"
"??????#?????? 3,1,1,1\n"
".#???#?#?.?????? 1,5,1,2,1\n"
"???.#???#.??#?#?. 1,2,2,5\n"
"..???#????### 1,2,4\n"
"????#???#????. 1,7,1\n"
"??????#????#.? 3,7,1\n"
"???#???????#?...? 4,5,1\n"
"#????????##?# 1,3,4\n"
"?.#???.???#??. 3,4\n"
".???????.??????.? 4,2,1,3\n"
".?.??.???? 2,2\n"
".???.??????###?#. 3,10\n"
"????..?????## 2,1,2,4\n"
"#?.???#??.??? 1,4,1\n"
"?????..???? 1,4\n"
"??????#.????????? 3,1,8\n"
"????#??????? 5,1,1,1\n"
"????#?#??#????? 1,4,1,2,1\n"
"?#?.???#???.? 2,6,1\n"
"?.???#??.?#. 1,1,1,1\n"
"??.#.#.??????#???? 1,1,1,10\n"
".##?.?????.. 2,2,1\n"
"???#?#??#??#??#? 5,1,1,1\n"
"?#.?.????????????#? 1,1,10\n"
"??#?????.. 3,1\n"
"?#.?#?#?????.?????? 1,2,3,1,4,1\n"
"?#???..#?.??#?#. 2,1,2,1,1\n"
".????#????.?#?????# 7,1,3\n"
"..###??#???#???.??? 10,1,1\n"
"??????##?.?#?#.#??# 4,3,2,1,2,1\n"
"?.???####.?#?? 4,2\n"
"?#.???#???#??##?#?? 1,15\n"
"?.?##?#?#? 5,2\n"
"?#???#?#??????##??? 9,3\n"
".??????????.??. 6,3,1\n"
"???????.#? 1,2,1\n"
"????#?#??#?#.. 5,6\n"
"?????.?.?#????? 2,1,5\n"
"????..??#?#?#??.???? 3,8\n"
"#???.?.??????. 1,2,1,2\n"
"?????????.???????.?. 1,2,3,4,1\n"
"????????##???? 1,7\n"
"?.??#.?#??#? 1,1,5\n"
"#??????#?##??? 3,9\n"
"???#??.?.#?#??### 4,8\n"
"?.##??##?#??? 2,7\n"
".?.#?#?????.#?#??.? 1,8,1,1,1,1\n"
"?.???#.?????? 2,2\n"
".#.??##???.#??.??. 1,5,3,1\n"
"??#???##?? 1,1,4\n"
"??????#??##?#. 2,8,1\n"
"????#?????.???.?.? 6,1,3\n"
".?.#.?##.??.????#? 1,1,2,2,2,2\n"
".??#?.???? 4,1,1\n"
"?.?#?##??##?#??.?? 2,8,1,1\n"
"#???##???.??. 1,2,1,1\n"
"?#???##??.??#??? 3,3,5\n"
".???#??#??? 1,5,1\n"
"?#.?????#???. 2,7\n"
"?.???#????????.?. 1,1,1,4,1\n"
"??#??#.??#??? 4,1,2\n"
"???#.????#???##???? 2,12\n"
"..??????.??#??#?? 2,6\n"
"??#?.?#?#???..??#?? 3,4,1,1,2\n"
"?#????.#?????#?. 2,3,3,3\n"
"?????#????.? 2,3,1\n"
".?.?????.?.##.? 5,2\n"
".???.???.???#?? 1,2,3\n"
".????.?#?#???.??. 1,7,2\n"
"???#???#??????.. 1,9,1\n"
".#???#?.?? 1,2\n"
"##?#??#?##??????#??# 2,7,8\n"
"?.?????#????##??.?? 1,8,2,1\n"
"??????#.##??##?##?## 3,1,9,2\n"
"???#?#?#???#? 1,7,1\n"
"???#????.?????? 6,1,1\n"
"?.##?#.?#?.?. 1,2,1,2\n"
".????.?..?????? 1,2,1,3,1\n"
"?.??????.. 1,1\n"
".?????.?#??. 1,4\n"
"???.??????... 2,1\n"
"?#?#?#?#.?..#..??? 6,1,1,1,1,1\n"
".??..?#???? 2,1,1\n"
"??#?????????#?..??? 10,2,1\n"
"?.???.?.?.?.#? 1,2,1,2\n"
"#?.?#?.?#???.??????# 2,2,2,1,2,2\n"
"????..??####???#?? 4,1,10\n"
".????..??#?? 1,3\n"
".#??#?#?.?.##. 6,2\n"
"??#?#..?.??#?#??# 2,1,1,5,1\n"
"??##??#??###??..??? 3,7,1,1\n"
"????.#.???..??. 1,1,1,1,2\n"
"#?.??..??. 1,1,1\n"
".#??????#?.????? 1,5,3,1\n"
"?.???#?..??#??? 4,4\n"
"?????##?#..#???#?? 7,1,1,1,1,1\n"
"?????????? 5,2\n"
"????.????.?#?.. 1,1,3\n"
"????????????#????#? 4,2,5,4\n"
"???#???.??##? 1,1,1,5\n"
"?##????????#????##?. 2,7,3\n"
"???..??#?? 2,3\n"
"#.?#?.???..?? 1,3,3,1\n"
".????????? 2,1,1\n"
"???????????##? 6,1,2\n"
"?..#????#?? 2,3\n"
"????.??..#? 3,1,2\n"
".#.?????#.?#?? 1,2,1,3\n"
"????????.?# 7,1\n"
"?????#?#??##??#???? 15,2\n"
"?#.??.?????#?? 1,1,7\n"
"??????#????#?#????? 8,1,7\n"
"#..????#???. 1,4,1\n"
"##??#.??????. 2,1,2,2\n"
".????.#?#####?. 1,1,7\n"
"#????#???..?????? 9,4\n"
"???#??.#?.# 3,1,1\n"
".?#?#.?..???? 4,2\n"
"??...??.?#?##??? 1,2,8\n"
"?.??#?????..???.?.? 5,1,1\n"
"?.?##??.?#?##????# 5,5,3\n"
"??#?????##??????? 9,1\n"
"???#????#? 1,2,2\n"
"?.?????????#?#?.?#? 1,3,7,2\n"
"???.?#??##?#?? 1,1,5,2\n"
"?????.#.?? 3,1,1\n"
"?#???#???..??.##??? 2,6,1,5\n"
"#??#????????? 2,1,3,1\n"
".#??.?.??.?#. 2,2,1\n"
".???#???????#??##??? 12,2,2\n"
"##?#?#???###???????? 13,1,1,1\n"
".?#.??##?????.? 1,3,2,1\n"
"#????.???#????. 1,1,3,2\n"
"##????????? 2,1,2\n"
"?#?..?#????.??? 3,6\n"
".?..??.??#??#?#? 1,1,7\n"
"?????????.???.? 1,1,1,2,1\n"
"??.????#.???? 1,1,1,2\n"
"###?##.??? 6,2\n"
".?#####???????.#??? 5,6,4\n"
".???.??????????? 1,2,1,1,2\n"
"?????#?#?#.??#??? 6,1,1,2,1\n"
"??.??#???.. 2,1,1\n"
"#..?.?.##??. 1,1,3\n"
"?##???.?.? 4,1,1\n"
"????????##??????.??# 1,10,1,1,1\n"
"???#.???.?????? 1,2,1,2,2\n"
"????????????.????#? 1,3,3\n"
".?.?????..?#?? 1,1,1,3\n"
"?..???##????##? 1,9\n"
".??????#??? 1,2,5\n"
".#?????.?..#???## 1,3,1,1,3\n"
"#????.???.? 5,1,1\n"
".?#.?????#??##??? 1,12\n"
"???.?#???.?#?? 2,4,4\n"
"?.?.??????.?????#?? 1,5,8\n"
"???##?#?#?.#. 4,4,1\n"
".#.???.????#????? 1,6\n"
"??#?##???#??.????? 9,2\n"
"?.?.###??##?#?? 1,11\n"
"???.?.???.? 1,1,2\n"
".?#?????#? 3,2\n"
"?.??#??#???#?#?## 8,6\n"
"???###.?????????? 4,6,1\n"
"?.???#???#?## 1,2,2,4\n"
"??##??????..???#?? 1,3,3,1,1\n"
".??.#?????#???..?? 1,9,1\n"
"...??????? 2,1\n"
"???.?###??.????? 3,3,1,1,1\n"
"??.?#?..???#????. 2,1,1,3,1\n"
"??????..#???.#. 1,4,2,1,1\n"
"?.??##?#???##?..???. 11,3\n"
"???##?.?##??? 5,4\n"
"????.??#?????? 3,7\n"
"#??#..?#???#?.? 1,1,2,3,1\n"
"????##?#???.?#?# 2,6,4\n"
"?#???.##????.? 3,6\n"
".?#????.#????.?.#? 4,1,1,1,2\n"
".??##?#.????#.. 6,3\n"
".#?#??..?? 3,1\n"
"#.?.??..??.?? 1,2,1,1\n"
".?????????#???#????? 1,10\n"
"?#.#..#?#?#?#????#?? 2,1,3,1,8\n"
"??????#????# 6,3\n"
"??????..#??#?. 1,1,3\n"
"?.??#.??????#?. 1,1,3,1,2\n"
"???..##.??##?.????? 1,2,5,2\n"
"??????..???# 2,2,1\n"
"?????#?.????..?#??#? 4,3,2,3\n"
".??#??????????#??? 11,2,1\n"
"??.??..?????.?? 1,1,5,1\n"
"#?###?.????????##?? 1,4,9\n"
".?#?#???#??.# 9,1\n"
"?????#.??#??#. 1,3,3,1\n"
"????#???#??#?.?????. 6,1,2,5\n"
"????????.##?# 1,1,2,1\n"
"??#?##??????? 8,2\n"
"???.???#?#????#??. 1,1,6,2,1\n"
"#??.#??????#? 2,1,3,1\n"
".###??.??.? 4,2\n"
"?????.??#. 3,1\n"
"??????.#..?# 4,1,1,1\n"
"?.#??#?.??##?##???? 4,8\n"
"??????#?#???? 2,6,1\n"
"???..###???..??????? 1,1,4,1,2,1\n"
"??..?.???#?? 1,1,1,3\n"
".??#?#????.?.#??#??? 3,1,5\n"
"??????.??? 1,1,3\n"
"#?.???#??.??#?. 2,5,3\n"
"??#??##??.? 6,1\n"
"?#?????????#?? 1,10\n"
".????#.??? 4,1\n"
".?###?..?#?#??? 5,5,1\n"
"??#??#.?#????.?. 1,1,1,3,1\n"
".???#???#???????? 1,9,1\n"
"???..?????? 1,2\n"
"??#?.#??##?. 3,2,2\n"
"?#?#????.?? 4,2\n"
"??#????.##??? 6,4\n"
"???#.??.?#?###?.#?? 2,1,6,3\n"
"???.?#?##?.? 1,5\n"
"?#.?##?.?? 1,4\n"
"????###??? 1,4\n"
"???##????#?# 1,3,1,3\n"
"##???????? 6,2\n"
"????#??.####?.? 2,2,1,4,1\n"
"#.??#????#???.???? 1,11,1,1\n"
"?#??????.? 1,1,1\n"
"#..?.?#?.??###??.? 1,1,3,5,1,1\n"
"???.??#??#?#?##?? 1,12\n"
"??????#??#?##?? 1,2,7\n"
"???#???.??.???#? 4,1,5\n"
"?????#?????#.?#?#??? 3,1,1,2,5\n"
"#??.????#? 3,1,3\n"
"???????????...# 8,1\n"
"#??#.#.?..????.? 1,1,1,1,4\n"
"?#????.??.?. 1,1,2,1\n"
"?.??##?.?.???#????.. 5,5\n"
"?#??#????.##.## 2,2,2,2,2\n"
"?.#????.?? 2,1,1\n"
".#??????????? 1,6\n"
"??#.??.#????.??#.??. 2,2,1,1,3,2\n"
"??#?#??.??#??? 5,1,2\n"
"???#?#??.???.??? 6,2,1\n"
".??#????...?????#.? 6,1,2,1\n"
"??.???????.?#??? 2,2,1,4\n"
".?.??????? 1,1,1\n"
".????..??#?#? 2,5\n"
"?.?#?##.???.?#??# 1,5,2,1,1\n"
".#??#?.??#?#??.?#??? 2,1,1,5,2,1\n"
"?.#??..????#?????#.? 2,10\n"
"???#???.?#.???????? 6,1,1,3\n"
"?.??#?###??.??##???? 1,8,4,1,1\n"
"?????#.??##? 1,2,1,2\n"
"..??.##.?.???# 1,2,3\n"
"??#?.????#???????? 2,10\n"
"?#??????#??.????? 7,1,1,1\n"
"#???.?#?.???.??#?? 1,1,2,1,1,5\n"
"??##????.#.#?.#?. 6,1,1,1\n"
"?#???#??????????.?.? 1,11,1\n"
"??#????#???#???. 3,1,8\n"
"?#???????.#??? 2,1,2,1\n"
"?.#???????.?? 1,1,2\n"
"???.????#????#???#? 3,1,4,4,2\n"
"????.#??##???#?.### 1,1,6,2,3\n"
"??????.?#?#?#?? 2,1,8\n"
".??????.#? 3,1\n"
"#??????.????#.????? 1,1,1,2,1,4\n"
"???????????????.??# 1,1,7,2\n"
"#??.????#?#??.??#?#? 1,7,6\n"
"??#?????????## 5,4\n"
"????.??#?.. 1,2,4\n"
"#?#??.#?#.?? 1,2,3,2\n"
"..?#?#?.?#??????#?? 3,1,7\n"
".?????#??###..?#?? 1,6,3\n"
"?.#?#????.????###. 1,5,1,1,1,3\n"
"?????####?##?.#.??? 10,1,1\n"
".?##???###???. 3,1,6\n"
".??#.?.???.?.?.?? 1,2,1,1\n"
"?#????.???.?? 6,1,1\n"
"??#.?????#? 1,1,2\n"
".??#?.?.#????? 3,1,1,1\n"
"??.?????????# 1,3,1,1\n"
"?#.#?????.?????? 2,1,1,5\n"
".????#??..????#? 1,1,3,4\n"
"?????..#?.#??# 4,1,4\n"
"??.????##?..?#?? 1,2,3,2\n"
"???##??.#?##???? 1,2,1,5,2\n"
"??#???????#???#? 4,8\n"
"#?#??#.???????#?. 4,1,2,1,2\n"
"?????#?#??.??.??? 1,5,2,2\n"
"?#???#???.? 1,2,1\n"
"????.?##??#???#??##? 3,7,5\n"
"#?????#?.#? 1,3,2\n"
".??#?####?##?#??? 11,1,1\n"
"####??#.###.??.?? 4,2,3,2,1\n"
"#???.??#?#??# 1,1,5,1\n"
"?##.?????. 3,2\n"
".?.????????#? 1,2,2,3\n"
"??????#??.??#?#?.? 8,5\n"
"??.?...?..?.??.?.?.? 1,1\n"
".#??.???#.?#?#?? 2,1,1,6\n"
"?.#??##??#???????? 1,1,2,4,1,1\n"
"##?.?.##??????#??.?? 2,10\n"
".?????##????.?.??#? 1,6,1,1,2\n"
".##??#?#??##?#??? 2,8,2\n"
"??.?#.??#?.???#??? 1,2,2,5\n"
"?????.?????????#?.? 1,1,3,2,2,1\n"
".#?##???##??.?.# 9,1,1\n"
"??????#???????? 7,2\n"
"#?????.?????#?. 1,2,1,1,1\n"
"?.#?????????#.#?# 1,1,4,1,3\n"
"?.??#??#??#??#.. 1,2,2,1,2\n"
"??.##??????#?????. 1,2,2,1,1,4\n"
"#?.?????#?.?##?? 1,2,2,5\n"
".?#?#?#?.?.# 6,1\n"
"#.????#?#??# 1,6,2\n"
"??.??????? 1,2\n"
"???#?.?..??.??#????. 2,2,4\n"
"??????#??????? 2,2,4,1\n"
"?.????#?..???? 5,1\n"
"???..????.?????? 3,1,3\n"
"???.???#??. 1,1\n"
"?...?#?.??.?#?.? 2,3\n"
"???#..??..#?#??. 4,2,3\n"
"..?????#??? 4,1\n"
"???##?.#???#?? 6,3,1\n"
"????#??.??.. 5,1\n"
"??????#??? 3,2\n"
"??????????#?????? 3,3\n"
"?????.??#??#??? 3,8\n"
"?#?##..?#.?#? 1,2,1,2\n"
"#???##?#????. 10,1\n"
"??????.???#??? 2,2\n"
"?????###??.???. 9,1\n"
"??##???#????.?#??#? 1,2,5,1,1,2\n"
"?.?????#??#.?? 1,5\n"
"?#...???#?#??#?. 1,9\n"
"???.#?????????.???# 3,6,2,1,1\n"
".?#?#????.?? 7,1\n"
"??.#?.#??#??.?? 1,2,1,1,1\n"
"????????##?..? 1,1,5,1\n"
"?????????????.?.?. 3,5,1\n"
"??#?.#?????? 1,1,1,1\n"
"?????????#..??#? 3,6,1,1\n"
".?.??..?.??.?.???.?. 1,2\n"
"????#???.?###...???? 6,4,1,1\n"
"???#?#??#??????..??. 13,2\n"
".##???.?????? 4,2\n"
"??????????? 7,1\n"
".???.#?#?##?.???. 1,6,1,1\n"
"?????.#?.??#???# 3,2,1,2,1\n"
"?????#?#?###??##??# 1,1,1,5,6\n"
"???...?#?.#??#?. 2,2,1,2\n"
".?#???????? 2,1\n"
"?.?##????????? 1,5,1,1\n"
"..??????##?#???.?? 3,8,2\n"
"?????.?.??????#?.?? 1,2,3,1,2,2\n"
"??#..??##?.# 1,3,1\n"
"#?#??..??#.?.?#?.??? 5,3,1,3,1,1\n"
"?????#??#??#? 1,2,1,1\n"
"??.#???#?#???#?..??? 12,1\n"
"??#?#..???#??? 3,1,1,1\n"
"?.??.??.#??#???#?#?? 1,11\n"
"??#.??#??#??.?? 1,5,2\n"
"?#???#?#?#?????.?? 10,1,1,1\n"
"?#???#?????##?. 7,4\n"
"???##??#?#.???.??. 5,1,1,1,1,2\n"
"????.?????#??? 3,1,3,1\n"
".???#?.??#?.????# 3,2,5\n"
"??#?????#????#??#??? 4,2,8\n"
"?????#???.#?#??? 1,3,1,3,1\n"
"?###.???#?????.#? 3,5,1\n"
"#.?##..??.#???. 1,2,1,1,1\n"
"??#?#??????.#?..?.?? 8,1,2,1,1\n"
"????.?????.????#??? 1,1,3,2\n"
"?#?#????#????#??# 6,1,1,1,2\n"
".???#?#???#?#?#????? 15,1\n"
"..???##.??. 1,3,2\n"
".???#.?#??#???? 4,1,2,1\n"
"????????#?#?#??##.? 2,11\n"
"??.?.??????#??. 3,3\n"
"??.???###????##??? 1,10\n"
"#????.?#??.??.??? 5,3,1,1\n"
"?.????????##.? 1,5,2,1\n"
"???#?##??#??. 2,4,2\n"
"?.#??.??#??#?#? 1,1,8\n"
".##???.?#???. 4,1,1\n"
"??#.????.?.#??#? 2,2,1,2,2\n"
"???##????# 1,5,1\n"
"#???????#?..?#??? 4,5,3,1\n"
"??.?????.???? 2,1,1,2\n"
"??.???.?????.???#?? 1,2,2,1,5\n"
"??.??#??#?#?..??. 1,7,1\n"
"?#???#?##?..?.?????? 9,5\n"
"#?##?#????..#? 6,1,1,1\n"
"#????.???. 3,2\n"
"?????##.?..??##????? 6,4\n"
"??????.??.??? 2,2,1,1\n"
"??????#?.??# 1,2,3\n"
"????#?????## 1,1,1,2\n"
"..#????#??#????. 2,2,2\n"
"?#.??.??????? 2,1,1\n"
".#???????#.?#?##.. 1,1,1,1,4\n"
"?????#....?.# 3,1,1\n"
"???????#??.?#?#?? 1,2,3,4\n"
".???#??#?? 3,1\n"
"??#??#???##??.#????? 1,11,1,1,1\n"
"??????#.#? 1,4,2\n"
".???#?.#??.? 1,1,2,1\n"
".?#?#????#.# 9,1\n"
"?#?.##???.?.?#.#?? 3,4,1,2,1,1\n"
"????.???.???..??? 3,2,1,1,1\n"
"#?#??..????.?????# 1,2,2,1,1,1\n"
".??#??.#?#??#???? 1,1,1,6,3\n"
"?#?????????????#??? 2,1,3,9\n"
"?????#.?????? 1,1,1,4\n"
"?.??#???#?.#????. 1,3,2,1,1\n"
"??..#?#?.? 1,4\n"
"????#?????#. 3,1,4\n"
"??.?##??#?###??#???? 1,15\n"
"????.??#?.?..? 3,3,1\n"
"#?.??.??#?####?? 1,1,1,8\n"
"?#????##??????????? 14,2\n"
"?#????.#??.? 1,2,3\n"
"???.##?????#?????? 2,2,1,3,1\n"
".?????????##?.# 1,8,1\n"
"??.???????? 1,2,2\n"
"??????#?#? 2,1,1\n"
"???????.#?? 1,3\n"
"?...?####????.?#?? 1,4,2,1,1\n"
".?##?#??????? 9,1\n"
"????.???????#???#?? 2,9\n"
"?????.?.????? 2,2\n"
"????.?????. 1,1\n"
".?????????###.??.? 11,1,1\n"
"????##?????.?? 1,2,1,1\n"
"???#?.#??##???#?#?.. 4,1,2,5\n"
"???????#??.??. 3,1,1,2\n"
".??????????#??#?? 4,6,3\n"
"??.?????..?.?##?#??? 1,1,2,1,4,1\n"
"??#..??.????? 2,1,1,1\n"
".#??#??.#??#? 1,3,5\n"
".?????##??????.? 3,6,1\n"
"##?.?#..?. 3,1,1\n"
"?.#.??????#?????#?? 1,12\n"
"#??.????.?# 3,1,1\n"
"#.#?#.##??#?..???? 1,1,1,6,1,1\n"
"????#???.???#??.. 3,4\n"
"???????.##??.???? 2,2,4,1\n"
"??#??#?.####???#??? 4,10\n"
".????###???###???? 6,6\n"
"???.??????. 1,3\n"
"??##..?#??#??###? 2,3,1,5\n"
".????#?#????.#? 9,1\n"
"??.???#.#????????? 4,1,2,2\n"
"???#?.????#?# 1,1,4,1\n"
".#?????.#??? 2,1\n"
"??????...???????#??# 5,2,1,5\n"
"#.?????###?????. 1,2,6\n"
"??##..????..?# 3,2,2\n"
"##???????.?#?. 2,2,1,3\n"
"??#?.#.??#.? 1,1,1,1\n"
"??##.??????..?.??. 4,1,1,1,1,1\n"
"??##?#?????????#?#?? 3,8,1,1\n"
"???????#????.????#?. 8,1,1,1,2\n"
"??????????#????#?? 1,2,11\n"
"???#??.??#. 5,2\n"
".??????????# 3,1,2\n"
"??#.?????##?#???. 1,10\n"
"?.#???#?#???#????# 1,1,4,2,1,1\n"
"#????.?#?????#??? 2,2,9\n"
".???#???##? 1,3,3\n"
".??.??#???#? 3,2\n"
"???#???##??#???.??## 14,3\n"
"???##?##??.##?.?.#?? 2,6,3,1,1\n"
"???###????#???? 6,6\n"
"??.?.?#?##?##?#???? 1,1,1,5,5\n"
"?#???..?.???#?#.?? 5,1,4,1\n"
"#?????#????#???#??? 4,1,1,1,5\n"
"??#.???#????#???? 1,5,1,2\n"
".??#?#???? 5,1\n"
"?.???..#???#?? 1,2,5,1\n"
"???#?##????..???##? 7,4\n"
"??..#?.???? 2,2,2\n"
"?.??#?.##?????#? 4,5,2\n"
"?.?##???##??##?#?. 9,4\n"
"??#?#??..#??????? 6,4\n"
"???#??.??.? 4,1\n"
"?..#?#?#?????????#? 1,6,1,2\n"
"???.#?..?? 1,2\n"
"??????????.?.#?. 4,2,1,1,1\n"
"#..??.???###?.?.? 1,1,6,1,1\n"
"??.?????#?#??#.?? 1,1,6,2\n"
"?.?##???#?? 3,2\n"
"??.???????? 1,5,1\n"
"?.#???#????#??## 1,1,5,1,2\n"
"???????????###??? 2,1,8\n"
"???.????.?# 2,1,2\n"
".#?.??#????#.?????? 1,1,1,4,1,1\n"
"#???###?##?.??...? 10,2,1\n"
"..#.??????.?# 1,1,4,1\n"
"????#?????#.? 1,5,1,1\n"
"???#??#??#??# 2,1,2,2\n"
"?#??????????#? 1,1,3,1\n"
"??#??#??#?#?? 3,1,4\n"
"???.?????????#. 1,1,1,2,1\n"
"#??##??.?#? 5,1,1\n"
"..?##???#?#???? 2,6\n"
"#??????#?.?? 2,1,2,1\n"
".###???.??###??#?? 5,10\n"
"?.????..?????#??? 4,3,2,1\n"
"???##??????? 1,3,1,2\n"
"????.?.####??####??? 1,11\n"
"??##???.?? 4,1\n"
"??#?.?????# 1,3,1\n"
"??.???...#..?. 1,3,1,1\n"
".##?#??#?#??#??#??? 2,1,5,1,4\n"
"?#.????#??????????## 1,1,2,10\n"
".#?.??#???? 2,5\n"
"?#?.#?????.??.? 3,4,2,1\n"
".#?????.?..?? 6,1,1\n"
"###????????###? 6,3,3\n"
"#??????.??#?#? 4,1,6\n"
"??????#?????? 1,2,1\n"
".?#.???#??????????#? 2,1,2,1,2,2\n"
".????#?????????? 5,5\n"
".??????????. 5,1\n"
"?????????.?#?? 2,5,1\n"
".?#??.?.?? 2,1,2\n"
"?.#.?#?#?. 1,4\n"
"??##.??##?#??###?? 3,5,3,1\n"
".????..??#?.? 1,1,4\n"
".???#?????# 1,3,3\n"
"??????.?????##???.? 6,7\n"
"???#?###?.??#?##??# 6,9\n"
"##???#?.#?..#?????. 6,2,3,1\n"
"???????#?#????#.?.?# 3,11,1,1\n"
"?#?.??#??#? 2,3,2\n"
"???#?????.?? 7,1,1\n"
"?.???????#?#??.?.#? 4,2,3,2\n"
".#.?#.??#??????? 1,1,1,5,1\n"
"?.##??????????? 7,1\n"
"?.?#????????.? 6,1\n"
".##??#?.???? 2,1,3\n"
"#?.#?#?#????.? 1,1,6\n"
"?##???#??#.???.? 6,1,1,1\n"
"???????#?? 2,1,1\n"
"..?#????#???#?? 1,1,3,4\n"
".?.#??##?#.?#??..#? 1,1,5,1,1,1\n"
"?#?##?#????. 6,1,1\n"
"#?#?????#?##???#?#?# 1,4,12\n"
".????#???? 1,2,1\n"
"?..??.???. 1,1\n"
".????????????.???? 4,1,1,1,1,1\n"
"??.??##???.?#?? 2,4,1,2\n"
"?????#.##???#??#?.? 1,3,4,1,1,1\n"
"??#?.?#??##. 1,2,6\n"
".???.??#?#.#????##.? 2,3,1,7\n"
".?.????????. 3,3\n"
"?????#.?.#...? 2,2,1,1\n"
"??????.##????..?. 3,4\n"
"?#.??????#???### 1,1,9\n"
"??..???#.??##????#?# 2,1,1,10\n"
"?????#?..#?. 3,2,1\n"
"???????..?# 2,1,1\n"
"???#???#?? 1,3,2\n"
".#?#??.?????????.? 5,1,1,1,1\n"
"?.#?.?.??????# 2,6\n"
"???#.??????? 1,1,1,3\n"
"?#???#?????.#?? 3,5,2\n"
"???#???????.?? 1,6,1,1\n"
"..?#????#.. 1,4\n"
"?????.???# 1,1,3\n"
"??#.?????????..? 1,1,1,5,1\n"
"??##??...??#??? 6,3\n"
"#??#????#? 2,2,1\n"
"?#???##.##???? 6,2\n"
"?.?#????.?#?.????# 1,3,1,3,1,3\n"
"??.##??#?????????.. 1,8,1,1\n"
"?###?##.?????#?.???# 4,2,1,4,3\n"
"???.???????.#.??? 2,1,3,1,2\n"
"??.???#????. 1,4,1\n"
".?##?????##???.???? 13,2\n"
"??##.???????#??#??#? 2,1,2,5,2\n"
"#??????##???. 2,1,3,2\n"
"#.???????? 1,1,1\n"
"?#?.#.?#??.??????? 1,1,4,1,3\n"
"?????#??#??? 2,5\n"
"??.??#?#?? 2,5\n"
"?.#?#?#?????????. 1,9,2,1\n"
"??#??.?##.??#.??? 1,3,1,1,3\n"
"???????.?????? 4,6\n"
"#?.?#??#?????.??? 2,9,1\n"
"#??#??#?.??#????# 5,2,4,1\n"
"?#.#?#?.?? 1,4\n"
".?.?.????#??#?? 1,1,1,2,2\n"
"?.#???????#?.?. 1,1,3,1\n"
"#.??????..?.?. 1,4,1,1\n"
"???????.#???#??.? 7,6,1\n"
"?..##???##???? 3,3\n"
"?????###?#..???#.?#? 1,1,5,1,1,1\n"
"??.????#?.?..# 2,2,1,1\n"
"????#???##??#? 6,5\n"
"#?????##??????? 1,1,3,1,4\n"
"#?.?????#?.?? 1,2,1,1\n"
"??..#?#??##? 1,3,3\n"
"???#??#???#??. 4,1,1\n"
"???.#??##???????? 3,6,1,1,1\n"
"#?###?#?##?.#?.?.?.. 1,9,1,1,1\n"
"?#???#??#?.?.#???? 1,4,1,4\n"
"????..#.?.???#??.? 2,1,1,4,1\n"
"?????##??#.??#?.# 9,2,1\n"
"????.?##??#?????..?. 2,3,1\n"
"??????.#?#???#??.??# 4,8,3\n"
"?#?##?#????????#?? 7,1,3\n"
"?#??###??#?#?#?.? 13,1\n"
"?.??##???.??????#.? 1,6,1,2,1,1\n"
"??#??#????? 3,3,1\n"
"??.??????????#.. 5,5\n"
"????????#?? 2,6\n"
"#?.??#???.#??? 1,6,1,1\n"
"##.?????#?. 2,2,1\n"
"????#??.?#???? 4,1,5\n"
".?????????????##?.? 5,3\n"
".?.???.?#??.## 2,1,2\n"
".?????????###????? 3,5\n"
".###??.##?? 5,3\n"
"?#??????#?.??#???? 5,3,3\n"
".????#??????? 1,2\n"
"??#??????..#???#?. 3,1,5\n"
".???#?#?.???.?????? 6,3,2,2\n"
"??.#??.???. 3,2\n"
"?.??.???#.?? 1,4,1\n"
".?????.???..#?? 1,1,1,1,3\n"
"#????????? 4,2\n"
"????#?...????????#?# 1,2,1,9\n"
"??#?#####???? 2,5,1\n"
".??#???#?. 3,2\n"
"?#?#?.##????#?????? 1,1,9,2\n"
"?####?????.?.???? 8,2\n"
"#???#??.??.??? 2,3,1,3\n"
".#??##?????#.#?? 7,1,1,1,1\n"
"?..????.???###????. 1,7\n"
"???##???#???.??#?#? 9,1,6\n"
"???#?????????. 3,5\n"
"#?#??#??#?. 3,5\n"
"?#??.?.???? 3,1\n"
"???###.?#.. 3,2\n"
"?????????.??? 4,1,1,2\n"
"???#??#??.? 8,1\n"
"#..??.#???? 1,5\n"
"????#??###?#?#?#???? 2,1,6,7\n"
"???????????###????. 13,1\n"
"???####?.? 1,4,1\n"
"?##.???#????##?##?? 2,1,9\n"
"???..??..?.#?#??#.. 3,2,6\n"
".#?#???.?#?##??? 1,1,1,6,1\n"
"??#?..??????#??? 1,6,1\n"
"#.????#??????# 1,8\n"
"???#??..?? 1,1\n"
"???..????????? 1,1,4,1\n"
".????.#???. 1,1\n"
"#???#?#?#?.??.#?? 9,2\n"
"#??#?##????.??.?? 10,1\n"
".?#?.?????##????#? 2,11\n"
"????#??.#???#?????? 1,4,1,3,1,1\n"
".?.??..???#?? 1,2,5\n"
".#?????.?.???#?#??#? 1,4,2,1,1,1\n"
"??#????#??#???#.??? 1,1,10,1,1\n"
".???..#??#???.. 2,7\n"
"??.#???.#?????? 1,2,1,5\n"
"????#??.??????#? 1,3,1,3,2\n"
"##?????##..???.???.? 2,6,3,1,1\n"
"??##???.??????#?? 7,4,1\n"
"#..##.??#???#??? 1,2,1,1,3\n"
"#??.?##...?? 1,3\n"
"??##?...###... 5,3\n"
"#?#??#????#??#..#? 11,2,1\n"
"???#?????#?#???#??.? 4,8\n"
"??.??????#????????? 9,1\n"
"??.??.?????# 1,1,5\n"
"???.??????#??? 1,1,3,1\n"
".?.#???.???#?????? 2,7\n"
"???##??.?#?###? 2,2,1,2,3\n"
"???????#.??.#????#.? 1,4,1,1,2,1\n"
".???#.????#.?????? 1,1,5,2,1\n"
"?.?.???###?##???? 1,10\n"
"?????.?#?.? 5,1\n"
"????????##.?? 3,5,1\n"
".???#??##?####??? 1,6,4\n"
"#?????????#?. 3,4\n"
".?.??#?.??.???.? 1,1\n"
".???#?????? 4,1,1\n"
"???#?#?..?...#???.. 4,1,1,1\n"
"?????.????##???? 1,1,1,1,6\n"
"??#..????? 1,1\n"
"?#?.?????#??#..?#. 2,2,2,2,2\n"
"????#..????? 4,3\n"
"??????????#.?. 2,4,1\n"
"??..#?????..?.#???? 1,6,1,1,1\n"
"??#?####????? 10,1\n"
"?#???#.?..?? 3,1,1\n"
"?????#????????????? 5,4,2\n"
"##??.??..?.?? 2,1\n"
".?#?#??.??####???? 6,8\n"
"##?.??#???#?#???. 3,4,3\n"
"?#.?#...?#.???.# 1,1,2,2,1\n"
"?#..????#??? 2,2,3,1\n"
"??#??????? 2,1\n"
"????..?.????#?# 3,1,1,3\n"
"?????.??.????#???#?? 1,1,1,1,2,7\n"
".?##??.?#?.? 4,2\n"
"????#??.??. 5,1,1\n"
"??????.??? 5,2\n"
"????????#?#? 2,1,4\n"
"??.?????????#??.#?? 2,5,4,1\n"
"??.??????????? 1,4,1,1\n"
"???#????.? 2,4,1\n"
"??????.?#?# 1,2,3\n"
"#???????#?. 1,4,1\n"
"????#.??#???.???.? 5,1,1,1,2,1\n"
"?#?????.??##?? 1,1,2,3\n"
"?...???????? 1,1,3\n"
".##????#.?#?? 3,2,1\n"
"#??#?.?.#??##.????? 5,1,5,1,1\n"
".???#????? 6,1\n"
"?#???????.?###??#. 2,1,1,4,1\n"
"#??????.???????? 5,1,1,1,3\n"
".?#??###?#?#?##?..?? 15,2\n"
".?.??#?######?.??.?? 1,10,2\n"
"??#???.#??#?????# 5,8,1\n"
"????.????? 4,3\n"
"??#.???.??? 1,1,3\n"
".????.##??????#?##? 4,2,2,4\n"
"??#??????###????#?.? 4,1,10,1\n"
"????#..???? 4,2\n"
"#?????????#???????.# 1,2,1,1,3,1\n"
"?#??##???.#?#.? 8,3,1\n"
"????.#?#???#### 1,1,1,3,4\n"
"??.?#?#?#?.??. 1,1,4,1\n"
"??#??????????.# 2,4,1\n"
"???#??.???##??#? 6,1,2,3\n"
"?.???#?#??#??##?.?.. 14,1\n"
"??.#??#?#??? 4,3\n"
"?#?.??????#??????#? 2,15\n"
"???.???#??.???#??. 1,2,3,5\n"
"?#?.?#?#?#?#???#???? 2,4,1,1,5,1\n"
"???????????#???. 1,1,6\n"
"??????????.?? 2,5,1\n"
".##???????.?#???? 9,3\n"
".???..?.?###? 2,1,3\n"
"?#??##??????????. 10,1\n"
"?????.????.?##?? 4,1,4\n"
".???##?.???????#? 1,2,1,6\n"
"????????????.?? 5,1,2\n"
".?#????????? 3,1,3\n"
"#?.?#?.??. 2,1\n"
"?#?#????????. 7,1\n"
"??????####???????#? 2,10,1\n"
"?.???..????? 1,4\n"
".????##??#?##? 2,9\n"
"#??#?#?#??.#.#?? 9,1,2\n"
"?#??.?###???????? 1,1,6,2,1\n"
"?###??????.?# 4,2,1\n"
"#.??#??.?##?#. 1,4,5\n"
"?????.????????? 1,1,5,2\n"
"??.?#..#?????#?? 1,2,3,5\n"
"?.??#????.?????#?# 6,8\n"
"?.??#.?##?????? 1,2,6,1\n"
"#??#.?.?.#?#?????#?# 1,1,1,1,1,9\n"
".????#??##?????#??? 9,5\n"
"?#????#?##.????? 7,2,1,1\n"
"?.??????.??? 1,1,2,1\n"
"??##???#?##?? 4,5,1\n"
"#??????####?.???? 1,8,1,1\n"
"?.#?###?????#?#? 5,4\n"
"?.??#.???.#.#?#. 1,2,1,1,3\n"
"#.#?#?##??##?.??.. 1,10,2\n"
"???????#?????#??? 3,2,1,1,5\n"
".?.#??.?#?#?.?#???? 1,1,4,2,2\n"
"??##???.???# 6,1,1\n"
"?#??..???#?#???#.??? 1,1,2,5,1,1\n"
"##?.??#???#??###? 2,3,2,5\n"
"?.???#???#?#?#???#? 1,1,1,1,9\n"
"?#??#??#??.?.#?. 2,2,2,1,2\n"
"????#??.?##? 4,3\n"
"?.?#???..?####???? 1,2,1,7,1\n"
"#???????.? 1,2,1\n"
"#?..???..??????? 1,1,1,1\n"
".#??#?????? 1,6,1\n"
".#?.?.???##?? 1,1,5\n"
"??#????.###?##??? 2,2,3,2,2\n"
"?#?.?.???. 2,1\n"
".??..???????.????? 2,3,1,1,1,1\n"
".??.#???.???? 3,2\n"
"...?.??#???.. 1,1\n"
".??.?.?????????#??? 1,3,2,5\n"
"?.???..?#.#????# 1,2,1,6\n"
".?#???.??#?????. 4,5\n"
"?##?.???..#? 3,3,2\n"
".##???#?#?.?#??.??? 3,4,3,2\n"
".????#??.?? 4,1\n"
"?##??#?###???#???#?? 2,5,1,5,1\n"
"??#??.?.##??? 1,2\n"
"..#????#??#?? 1,2,1,3\n"
"??????##?. 2,3\n"
".????????.?#????? 1,6,1,2\n"
"??.?#????.#??#?. 1,2,2,1,1\n"
".?#?????????.#?# 2,5,1,1,1\n"
"???????.???????#?#? 2,10\n"
"?#?#?.#.?????#? 3,1,2,2\n"
"???????#?????????? 3,1,4,2\n"
"?.?.??????? 1,3,1\n"
"????.#???#?.##.?? 1,1,5,2\n"
"????..#????.????? 3,1,1,1,2\n"
"????#?.#???#?? 6,6\n"
"?.?#???.??.??### 1,2,1,1,3\n"
"..##?.??#?.?#?.#?. 3,1,2,2,2\n"
".?##?#??.? 2,1,1\n"
"?#???##?????. 6,1\n"
"???#?#???#?#?#???? 2,3,7,2\n"
".#?#?..####?? 1,1,6\n"
"#???#??#????? 2,9\n"
"?..?#??????#???.?#? 1,1,8,2\n"
"?.#???#??? 1,1,4\n"
"..???##???#?#?.#??. 11,2\n"
"????##????. 1,6\n"
"??????#??.?????. 1,1,1,2,2\n"
"?#?##???????#.?#? 13,2\n"
"?????????# 2,2\n"
"##???????. 5,3\n"
"????????##??# 2,5,1\n"
"???#?#?##???#?#??#? 8,1,1,4\n"
"?.????????. 6,1\n"
"???????#.??#?#??# 4,3,7\n"
"#####????#?????????. 10,1,1,1\n"
"#??????#?#.?????? 1,6,1,2\n"
".??.??????????#?# 4,3\n"
".???..#??. 1,3\n"
"???.?????? 1,1,2\n"
"#?.??#???.??? 1,3,1,1\n"
"???????.???.. 1,2\n"
".##???#?.#???#?#?# 2,2,9\n"
".?#???.?.? 1,1\n"
"?#?#????#?#.??#? 4,3,1,4\n"
".?????.?????????# 4,1,6,1\n"
"????.???#?#??###? 4,1,5,3\n"
"??#????????#??#?..# 3,1,1,3,1,1\n"
".?????.?????????.# 1,1,1,1,5,1\n"
"..?????????#???.??? 5,5,1\n"
"??#????#?? 1,1,1\n"
"????#?#?????? 1,1,4,1\n"
"???#??#??.?#?? 7,2\n"
"????.#??.?.##? 1,1,1,3\n"
"??.#???.??? 1,2,1\n"
"#?????##?#????? 11,1\n"
"?...??#??. 1,5\n"
"?????#?#?.???# 1,1,3,4\n"
"??.??##.####????.# 2,1,2,7,1\n"
"??#????..? 5,1\n"
"????#??#???#??#?##? 3,2,7\n"
".???##????.##?##?. 5,5\n"
"??#??#??#?#? 1,9\n"
"??#?#??#??.#???#???? 10,5,2\n"
".??.?????#? 2,1,2\n"
"???#.??#?#??#? 1,1,9\n"
"??#?????..???# 7,4\n"
"..#??.?###???#?#.? 3,9\n"
"???#?????##?.????# 3,4,5\n"
"#??#?#???# 1,4,2\n"
"??#??#???#?.#?#??? 1,1,6,1,1,1\n"
"??#????.???#.#? 2,2,1,1,2\n"
"##?#?????#?.????#?? 6,3,5\n"
"????#?.?????? 3,3\n"
"??#.???.?.#????#???? 2,1,2,7\n"
"??#?#???.???? 8,1\n"
"#.?#.?#????.???. 1,1,3,1,3\n"
"##???#????.?..?.??? 10,1,1,1,1\n"
"????#??#?????? 1,7,3\n"
"???.?.??.??? 2,1,1,1\n"
"?#?###?????.?#?#?.?? 9,1,1,1,1\n"
"???###?##???.#? 1,4,2,1,1\n"
"????###?????#?.? 1,11,1\n"
"????#??..??##??? 5,1,3\n"
".????##??????..##. 12,2\n"
"?.#????#?? 2,2\n"
"????????#?#????#??.? 2,4,3\n"
"????.#???.??#?#. 4,3,5\n"
"??##????.#?.?#. 7,1,1\n"
".?.??.??..? 1,2\n"
"##???.#?.? 2,2,2\n"
".?????#?.??#.? 4,2,1\n"
"..##??#??#? 2,2,2\n"
"??..?.?.??..?. 1,1\n"
"???.?.?..???#?#?? 1,1,8\n"
"???##?#???#????? 1,3,2,2,1\n"
"?.?????#?????#??.??? 1,1,2,6,2\n"
"?????.#?????#?#???. 1,1,9,2\n"
"?#?.????.???????## 1,4,1,1,1,2\n"
".?.?##??.### 2,3\n"
"??????##???# 2,4,2\n"
".?#.#.?#????..#.?? 2,1,1,3,1,1\n"
"?.#???..??????.? 2,3\n"
"#..#??????????? 1,1,3,5\n"
"??.??.???.?...? 1,2\n"
".?.#???#?#. 1,4\n"
"#??..??#.?#? 1,1,1,3\n"
"?.?##??.#.?? 4,1\n"
"???????.#??? 1,2,1,1\n"
".????#??.?. 2,3,1\n"
"????.?#???? 2,3,1\n"
"???#???.?#?????? 1,4,2,2,1\n"
".#?????..???????.? 6,7\n"
;

using Length = unsigned long;

struct Group {
    Length min;
    Length max;
    bool attached;
};

/*
auto groupToStr(const Group& gr)
{
    return std::to_string(gr.min) + " " + std::to_string(gr.max) + " "
        + (gr.attached ? "YES" : "NO");
}
*/

constexpr auto Factor = 5U;

} // namespace

auto day12Part2(std::string_view streamSource, bool sourceIsFilePath)
{
    std::shared_ptr<std::istream> inputStream;

    if (sourceIsFilePath) {
        inputStream = std::static_pointer_cast<std::istream>(
            std::make_shared<std::ifstream>(std::string(streamSource)));
    } else {
        auto sstream = std::make_shared<std::stringstream>();
        (*sstream) << streamSource;
        // use std::move(sstream) in C++20 or more.
        inputStream = std::static_pointer_cast<std::istream>(sstream);
    }

    using CombCount = unsigned long;

    CombCount res = 0U;

    unsigned lineCount{0U};

    constexpr auto MaxLineLength = 1000;
    std::array<char, MaxLineLength + 1> cc{};
    while (inputStream->getline(cc.data(), MaxLineLength, '\n')) {
        ++lineCount;
        std::string errorLine = "Input error at the line n. "
            + std::to_string(static_cast<int>(lineCount)) + " : ";

        auto c = static_cast<size_t>(inputStream->gcount());
        // 'c' includes the delimiter, which is replaced by '\0'.
        if (c > MaxLineLength) {
            throw std::invalid_argument(
                errorLine + "longer than " + std::to_string(MaxLineLength));
        }

        std::string line;
        // std::cout << "length = " << c << '\n';
        if (cc.at(c - 1U) == '\0') { // 'c' is positive as line has been extracted.
            --c; // excludes '\0' that replaced the delimiter '\n'.
        }
        line = std::string_view(cc.data(), c);
        // std::cout << "line: " << line << '\n';

        // std::stringstream lineStream;
        // lineStream << line;

        std::list<Length> groupsLen;
        std::list<Group> groups;

        char lastChar = '.';

        bool startWithDot = (line.front() == '.');
        bool endWithDot{};

        Length groupSize = 0U;
        bool readingNewGroupSize = false;

        bool foundGroups = false;
        for (auto ch : line) {
            bool digit = std::isdigit(ch);
            if (ch != ',') {
                if (foundGroups && !digit) {
                    if (!std::isdigit(ch)) {
                        throw std::invalid_argument(
                            errorLine + "not a digit nor comma after numbers started "
                            + std::string(1U, ch));
                    }
                }
            }

            bool newAttached = false;
            switch (ch) {
            case '.':
                endWithDot = true; // unless switch back to false
                break;
            case '#':
                switch (lastChar) {
                case '?':
                    newAttached = true;
                    [[fallthrough]];
                case '.':
                    groups.push_back(Group{1U, 1U, newAttached});
                    break;
                case '#':
                    groups.back().min = ++(groups.back().max); // increase both
                    break;
                default:
                    throw std::runtime_error(
                        "unexpected previous char value: "
                        + std::to_string(static_cast<int>(lastChar)));
                }

                endWithDot = false;
                break;
            case '?':
                switch (lastChar) {
                case '#':
                    newAttached = true;
                    [[fallthrough]];
                case '.':
                    groups.push_back(Group{0U, 1U, newAttached});
                    break;
                case '?':
                    groups.back().max++;
                    break;
                default:
                    throw std::runtime_error(
                        "unexpected previous char value: "
                        + std::to_string(static_cast<int>(lastChar)));
                }

                endWithDot = false;
                break;
            case ' ':
                foundGroups = true;
                break;
            case ',':
                if (groupSize == 0U) {
                    if (readingNewGroupSize) {
                        throw std::invalid_argument(errorLine + "comma ending a zero-value");
                    } // else
                    throw std::invalid_argument(
                        errorLine + "unexpected comma before number starting");
                }

                groupsLen.push_back(groupSize);
                groupSize = 0U;
                readingNewGroupSize = false;
                break;
            default:
                // must be a digit
                if (!digit) {
                    throw std::invalid_argument(
                        errorLine + "unexpected char " + std::string(1U, ch));
                } // else:

                constexpr Length BaseTen = 10U;
                groupSize *= BaseTen;
                groupSize += static_cast<Length>(ch - '0');
                readingNewGroupSize = true;
            }

            lastChar = ch;
        }

        if (readingNewGroupSize) {
            if (groupSize == 0U) {
                throw std::invalid_argument(errorLine + "comma ending a zero-value");
            }
            groupsLen.push_back(groupSize);
        }

        /*
        std::cout << line << '\n';
        for (const auto l : groupsLen) {
            std::cout << "group len = " << l << '\n';
        }
        for (const auto& gr : groups) {
            std::cout << "group = " << groupToStr(gr) << '\n';
        }
        */

        // Find combinations count:

        // recursive call

        Length sumResidualGroupsMin = 0U;
        Length sumResidualGroupsMax = 0U;
        Length sumResidualLen = 0U;

        using ItGroups = decltype(groups.begin());
        using ItLen = decltype(groupsLen.begin());

        using Triple = std::tuple<Length, Length, Length, bool>;
        const auto hashTriple = [](const Triple& triple) {
            // NOLINTNEXTLINE(readability-magic-numbers)
            return (std::get<0>(triple) << 20U) + (std::get<1>(triple) << 10U)
                + std::get<2>(triple) + (std::get<3>(triple) ? 1U : 0U);
        };
        const auto eqTriple = [](const Triple& triple1, const Triple& triple2) {
            return (std::get<0>(triple1) == std::get<0>(triple2))
                && (std::get<1>(triple1) == std::get<1>(triple2))
                && (std::get<2>(triple1) == std::get<2>(triple2))
                && (std::get<3>(triple1) == std::get<3>(triple2));
        };

        std::unordered_map<Triple, CombCount, decltype(hashTriple), decltype(eqTriple)> mapRes(
            0U, hashTriple, eqTriple);

        std::function<CombCount(ItLen, ItGroups, bool)> combCounting;
        combCounting = [&groups,
                        &groupsLen,
                        &combCounting,
                        &sumResidualGroupsMin,
                        &sumResidualGroupsMax,
                        &sumResidualLen,
                        &mapRes](ItLen lenIt, ItGroups grIt, bool needToUseFirst) {
            if ((sumResidualGroupsMin > sumResidualLen)
                || (sumResidualGroupsMax < sumResidualLen)) {
                // speed-up
                return static_cast<CombCount>(0U);
            }

            const auto triple = std::make_tuple(
                sumResidualGroupsMin, sumResidualGroupsMax, sumResidualLen, needToUseFirst);

            const auto cIt = mapRes.find(triple);
            if (cIt != mapRes.end()) {
                return cIt->second;
            }

            CombCount resPartial = 0U;

            bool tryIgnoreHead = !needToUseFirst;

            const auto gMin = (grIt != groups.end()) ? grIt->min : 0U;
            const auto gMax = (grIt != groups.end()) ? grIt->max : 0U;
            const auto len = (lenIt != groupsLen.end()) ? *lenIt : 0U;

            if (lenIt == groupsLen.end()) {
                // Only possible if all other groups have min=0.

                bool foundMatch = true;
                while (grIt != groups.end()) {
                    if (grIt->min > 0U) {
                        foundMatch = false;
                        break;
                    }
                    ++grIt;
                }

                if (foundMatch) {
                    ++resPartial;
                    // std::cout << "Found a full match\n";
                } else {
                    // std::cout << "Ended lengths but not groups\n";
                }

                tryIgnoreHead = false;
            } else if (grIt == groups.end()) {
                // std::cout << "Ended groups but not lengths\n";
                tryIgnoreHead = false;
            } else if (gMin > len) {
                // std::cout << "n. of # is higher than residual length\n";
                tryIgnoreHead = false;
            } else if (gMax == len) {
                // either '#' or '?' with the exact needed number.
                sumResidualLen -= len;
                ++lenIt;
                sumResidualGroupsMax -= gMax;
                sumResidualGroupsMin -= gMin;
                ++grIt;

                bool doCall = true;
                bool toRestore = false;
                bool toRestore2 = false;
                if (grIt != groups.end()) {
                    if (grIt->attached) {
                        // its minimum must be 0 (contain '?')
                        if (grIt->min > 0U) {
                            // there are '#'
                            doCall = false;
                        } else {
                            if (grIt->max <= 1U) {
                                // TODO: explain why no need to check for 0 (== 1U still ok).
                                // speed-up
                                sumResidualGroupsMax -= grIt->max;
                                // sumResidualGroupsMin -= grIt->min; grIt->min is zero
                                ++grIt;
                                toRestore2 = true;
                            } else {
                                toRestore = true;
                                grIt->max--; // the first '?' must be '.'
                                --sumResidualGroupsMax;
                                // its min remains zero
                            }
                        }
                    } // else: nothing to restore
                }

                if (doCall) {
                    resPartial += combCounting(lenIt, grIt, false);

                    if (toRestore2) {
                        --grIt;
                        sumResidualGroupsMax += grIt->max;
                        // sumResidualGroupsMin += grIt->min; grIt->min is zero
                    }
                    if (toRestore) {
                        grIt->max++;
                        ++sumResidualGroupsMax;
                    }
                }

                // restore
                --grIt;
                sumResidualGroupsMax += gMax;
                sumResidualGroupsMin += gMin;
                --lenIt;
                sumResidualLen += len;
            } else
                // min <= L  &&  max != L
                if (gMax < len) {
                // there must also be a next group attached
                sumResidualLen -= gMax;
                (*lenIt) -= gMax; // consume all
                sumResidualGroupsMax -= gMax;
                sumResidualGroupsMin -= gMin;
                ++grIt;

                if (grIt != groups.end()) {
                    if (grIt->attached) {
                        resPartial += combCounting(lenIt, grIt, true);
                    }
                }

                // restore
                --grIt;
                sumResidualGroupsMax += gMax;
                sumResidualGroupsMin += gMin;
                (*lenIt) += gMax;
                sumResidualLen += gMax;
            } else {
                // min <= L  &&  max > L
                // break in two as it contained for sure '?' because min!=max.

                Group newGr{0U, gMax - len - 1U, false}; //'attach' does not really care here

                bool remove = false;

                sumResidualGroupsMax
                    -= (len + 1U); // used ones and then the additional for '?' -> '.'
                // sumResidualGroupsMin -= grIt->min; grIt->min is zero

                if (newGr.max > 0U) {
                    ++grIt;
                    groups.insert(grIt, newGr); // before grIt
                    --grIt; // back to the new one
                    remove = true;
                } else {
                    ++grIt; // move to next
                }

                sumResidualLen -= len;
                ++lenIt;

                resPartial += combCounting(lenIt, grIt, false);

                // restore
                --lenIt;
                sumResidualLen += len;
                if (remove) {
                    grIt = groups.erase(grIt); // goes after the new one.
                }
                --grIt;
                sumResidualGroupsMax += (len + 1U);
                // sumResidualGroupsMin -= grIt->min; grIt->min is zero
            }

            // second chance in case of '?': ignore this group or its part.
            if ((gMin == 0U) && tryIgnoreHead) {
                const auto saveMax = gMax;

                while (grIt->max > 1U) {
                    grIt->max--;
                    sumResidualGroupsMax--;
                    // sumResidualGroupsMin unchanged for removing '?'

                    resPartial += combCounting(lenIt, grIt, true);
                    // passing needToUseFirst to true, as this cycle manages
                    // to avoid an initial part of the current group.
                }

                grIt->max = saveMax; // <=> = gMax <=> += (gMax-1U)
                sumResidualGroupsMax += (gMax - 1U);
                // sumResidualGroupsMin unchanged for restoring '?'

                // Now try to avoid the overall group
                sumResidualGroupsMax -= gMax;
                sumResidualGroupsMin -= gMin;
                ++grIt;
                resPartial += combCounting(lenIt, grIt, false);
                // next group has '#', therefore the value passed as needToUseFirst
                // does not matter.

                // restore
                --grIt;
                sumResidualGroupsMax += gMax;
                sumResidualGroupsMin += gMin;
            }

            mapRes[triple] = resPartial;

            return resPartial;
        };

        // TODO: check unsigned::max può includere groupsLen.size()*Factor.

        using LengthenIndex = int; // even negative
        const auto factor = static_cast<LengthenIndex>(Factor);


        const auto groupsLenOrg = groupsLen;

        for (LengthenIndex i = 1; i < factor; ++i) { // 1 less
            std::copy(
                groupsLenOrg.cbegin(), groupsLenOrg.cend(), std::back_inserter(groupsLen));
        }

        const auto singleQAtt = Group{0U, 1U, true};
        const auto singleQNot = Group{0U, 1U, false};

        const auto groupsOrg = groups;
        for (LengthenIndex i = 1; i < factor; ++i) { // 1 less
            bool first = true;
            for (auto gr : groupsOrg) {
                if (first) {
                    // must add '?'.

                    if (!endWithDot) {
                        auto& grBack = groups.back();

                        if (grBack.min > 0U) {
                            // it was '#'
                            groups.push_back(singleQAtt);
                            // new attached group
                        } else {
                            grBack.max++; // lengthen the group with '?'
                        }
                    } else {
                        groups.push_back(singleQNot);
                    }
                }

                if (first && !startWithDot) {
                    if (gr.min == 0U) {
                        // Even 'gr' contains '?'
                        groups.back().max += gr.max;
                    } else {
                        gr.attached = true;
                        groups.push_back(gr);
                    }
                } else {
                    groups.push_back(gr);
                    // in case (first && startWithDot), gr.attached is already false.
                }

                first = false;
            }
        }

        /*
        std::cout << line << '\n';
        for (const auto l : groupsLen) {
            std::cout << "group len = " << l << '\n';
        }
        for (const auto& gr : groups) {
            std::cout << "group = " << groupToStr(gr) << '\n';
        }
        std::cout << "\n\n\n";
        */

        sumResidualGroupsMin = std::accumulate(
            groups.cbegin(), groups.cend(), 0U, [](const Length acc, const Group& gr) {
                return acc + gr.min;
            });
        sumResidualGroupsMax = std::accumulate(
            groups.cbegin(), groups.cend(), 0U, [](const Length acc, const Group& gr) {
                return acc + gr.max;
            });
        sumResidualLen = std::accumulate(
            groupsLen.cbegin(), groupsLen.cend(), 0U);

        auto combCount = combCounting(groupsLen.begin(), groups.begin(), false);

        // std::cout << "Combination count for line " << (lineCount + 932) << " = " << combCount
        //           << "\n";

        res += combCount;
    }

    std::cout << "Lines count " << lineCount << std::endl;
    std::cout << "\nResult: " << res << "\n\n\n";
    return res;
}

int main12p2()
{
    try {
        day12Part2(Input, false);
        // day12Part2("./12_input_file.txt",true);
    } catch (std::invalid_argument& ex) {
        std::cout << std::endl; // in order to flash
        std::cerr << "Bad input: " << ex.what() << std::endl;
        return 1;
    } catch (std::exception& ex) {
        std::cout << std::endl; // in order to flash
        std::cerr << "Error: " << ex.what() << std::endl;
        return 1;
    } catch (...) {
        std::cout << std::endl; // in order to flash
        std::cerr << "Unknown error: " << std::endl;
        return 1;
    }

    return 0;
}


/*
OUTPUT:

Example:
Lines count 6
Result: 525152

Real input:
Lines count 1000
Result: 17485169859432
*/
